<html>
<head>
  <title>lesson10 组件生命周期（旧）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/604762 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1040"/>
<h1>lesson10 组件生命周期（旧）</h1>

<div>
<span><div><span style="font-weight: bold;">1、引出声明周期</span></div><div><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(36, 41, 47); font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, &quot;Noto Sans&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">在 React 中为我们提供了一些生命周期钩子函数，让我们能在 React 执行的重要阶段，在钩子函数中做一些事情</span></div><div><span style="font-size: 12pt;"><br/></span></div><div><span style="font-size: 16px; color: rgb(36, 41, 47); font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, &quot;Noto Sans&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;;">例如</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#24292F" face="-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji">&lt;script type=&quot;text/babel&quot;&gt;</font></div><div><font color="#24292F" face="-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji">    class Demo extends React.Component{</font></div><div><font color="#24292F" face="-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji">        state={</font></div><div><font color="#24292F" face="-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji">            opacity:1</font></div><div><font color="#24292F" face="-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji">        }</font></div><div><font color="#24292F" face="-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji">        destory=()=&gt;{</font></div><div><font color="#24292F" face="-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji">            // 卸载组件</font></div><div><font style="font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, &quot;Noto Sans&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;; color: rgb(36, 41, 47);">            ReactDOM.unmountComponentAtNode(document.getElementById('myDiv'))</font></div><div><font color="#24292F" face="-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji">        }</font></div><div><font color="#24292F" face="-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji">        // 组件挂载完毕</font></div><div><font color="#24292F" face="-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji">        componentDidMount(){</font></div><div><font color="#24292F" face="-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji">            this.timer=setInterval(()=&gt;{</font></div><div><font color="#24292F" face="-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji">                let {opacity} = this.state</font></div><div><font color="#24292F" face="-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji">                opacity-=0.1</font></div><div><font color="#24292F" face="-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji">                if(opacity&lt;=0) opacity=1</font></div><div><font color="#24292F" face="-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji">                this.setState({opacity})</font></div><div><font color="#24292F" face="-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji">            },200)</font></div><div><font color="#24292F" face="-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji">        }</font></div><div><font color="#24292F" face="-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji">        // 组件将要卸载</font></div><div><font color="#24292F" face="-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji">        componentWillUnmount(){</font></div><div><font color="#24292F" face="-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji">            clearInterval(this.timer)</font></div><div><font color="#24292F" face="-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji">        }</font></div><div><font color="#24292F" face="-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji">        // 初始化渲染 状态更新后</font></div><div><font color="#24292F" face="-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji">        render() {</font></div><div><font color="#24292F" face="-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji">            return(</font></div><div><font color="#24292F" face="-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji">                &lt;div&gt;</font></div><div><font color="#24292F" face="-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji">                    &lt;p style={{opacity:this.state.opacity}}&gt;aabbccdd&lt;/p&gt;</font></div><div><font color="#24292F" face="-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji">                    &lt;button onClick={this.destory}&gt;清除组件&lt;/button&gt;</font></div><div><font color="#24292F" face="-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji">                &lt;/div&gt;</font></div><div><font color="#24292F" face="-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji">            )</font></div><div><font color="#24292F" face="-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji">        }</font></div><div><font color="#24292F" face="-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji">    }</font></div><div><font color="#24292F" face="-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji">    ReactDOM.render(&lt;Demo /&gt;,document.getElementById('myDiv'))</font></div><div><font color="#24292F" face="-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji">&lt;/script&gt;</font></div><div><font color="#24292F" face="-apple-system, BlinkMacSystemFont, Segoe UI, Noto Sans, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji"><br/></font></div></div><div><br/></div><div><span style="font-weight: bold;">2、react生命周期 （旧）</span></div><div><img src="lesson10 组件生命周期（旧）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>通过 修改状态（setState）与强制更新（forceUpdate）的声明周期</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&lt;script type=&quot;text/babel&quot;&gt;</div><div>    class Demo extends React.Component{</div><div>        // 构造器</div><div>        constructor(props){</div><div>            super(props)</div><div>            console.log('Demo-constructor')</div><div>            this.state={</div><div>                count:0</div><div>            }</div><div>        }</div><div>        // 组件将要挂载</div><div>        componentWillMount(){</div><div>            console.log('DEMO-componentWillMount')</div><div>        }</div><div>        // 组件挂载完毕</div><div>        componentDidMount(){</div><div>            console.log('Demo-componentDidMount')</div><div>        }</div><div>         // 组件将要卸载</div><div>         componentWillUnmount(){</div><div>            console.log('Demo-componentWillUnmount')</div><div>        }</div><div>        // 控制组件更新的‘阀门’</div><div>        shouldComponentUpdate(){</div><div>            console.log('Demo-shouldComponentUpdate')</div><div>            // 返回true 生命周期向下继续走</div><div>            // 返回false 就此停住不往下走</div><div>            return true</div><div><br/></div><div><br/></div><div>        }</div><div>        // 组件将要更新</div><div>        componentWillUpdate(){</div><div>            console.log('Demo-componentWillUpdate')</div><div>        }</div><div>        // 组件更新完毕</div><div>        componentDidUpdate(a,b){</div><div><span>    </span><span>    </span><span>    //a:之前传过来的props b：是state变化之前的值</span><br/></div><div>            console.log('Demo-componentDidUpdate',a,b)</div><div>        }</div><div>        // 卸载组件方法</div><div>        deth=()=&gt;{</div><div>            // 卸载组件</div><div>            ReactDOM.unmountComponentAtNode(document.getElementById('myDiv'))</div><div>        }</div><div>        // 强制更新组件方法</div><div>        force=()=&gt;{</div><div>            this.forceUpdate()</div><div>        }</div><div>        add=()=&gt;{</div><div>            let {count} = this.state</div><div>            this.setState({count:count+1})</div><div>        }</div><div>        // 初始化渲染 状态更新后</div><div>        render() {</div><div>            console.log('Demo-render')</div><div>            return(</div><div>                &lt;div&gt;</div><div>                   &lt;span&gt;{this.state.count}&lt;/span&gt;</div><div>                   &lt;button onClick={this.add}&gt;点击加1&lt;/button&gt;</div><div>                   &lt;button onClick={this.deth}&gt;卸载&lt;/button&gt;</div><div>                   &lt;button onClick={this.force}&gt;不更改任何状态中的数据，更新&lt;/button&gt;</div><div>                &lt;/div&gt;</div><div>            )</div><div>        }</div><div>    }</div><div>    ReactDOM.render(&lt;Demo /&gt;,document.getElementById('myDiv'))</div><div><br/></div><div><br/></div><div>&lt;/script&gt;</div></div><div>修改状态<img src="lesson10 组件生命周期（旧）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>强制更新<img src="lesson10 组件生命周期（旧）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div><span style="font-weight: bold;">3、父子组件，以及父向子传值，</span></div><div>子组件中 componentWillReceiveProps 钩子在初始化接收props参数的时候不会触发，再下一次接收参数的时候才会触发</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&lt;script type=&quot;text/babel&quot;&gt;</div><div>    class Father extends React.Component{</div><div>        state={</div><div>            name:'小明'</div><div>        }</div><div>        changeName=()=&gt;{</div><div>            let {name}=this.state</div><div>            this.setState({name: name==='小明'?'小王':'小明'})</div><div>        }</div><div>        render(){</div><div>            return(</div><div>                &lt;div&gt;</div><div>                    &lt;Son sonName={this.state.name}/&gt;</div><div>                    &lt;button onClick={this.changeName}&gt;换个名字&lt;/button&gt;</div><div>                &lt;/div&gt;</div><div>            )</div><div>        }</div><div>    }</div><div><br/></div><div>    class Son extends React.Component{</div><div>        // 组件将要接收新的props的钩子</div><div>        componentWillReceiveProps(props){</div><div>            console.log('son-componentWillReceiveProps')</div><div>            // 这里也能收到传的参数</div><div>            console.log(props)</div><div>        }</div><div>        render(){</div><div>            return &lt;h1&gt;{this.props.sonName}&lt;/h1&gt;</div><div>        }</div><div>    }</div><div>   </div><div>    ReactDOM.render(&lt;Father /&gt;,document.getElementById('myDiv'))</div><div>&lt;/script&gt;</div></div><div><br/></div><div><span style="font-weight: bold;">总结</span></div><div><br/></div><div><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(36, 41, 47); font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, &quot;Noto Sans&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">React 生命周期主要包括三个阶段：初始化阶段，更新阶段，销毁阶段 </span></div><div><span style="font-size: 16px; color: rgb(36, 41, 47);">初始化阶段--由ReactDOM.render触发</span></div><div><span style="font-size: 16px; color: rgb(36, 41, 47);">           1、</span><span style="font-size: 12pt; color: rgb(36, 41, 47);">constructor</span></div><div><span style="font-size: 12pt; color: rgb(36, 41, 47);">           2、</span><span style="font-size: 12pt; color: rgb(36, 41, 47);">componentWillMount</span></div><div><span style="font-size: 12pt; color: rgb(36, 41, 47);">           3、</span><span style="font-size: 12pt; color: rgb(36, 41, 47);">render</span></div><div><span style="font-size: 12pt; color: rgb(36, 41, 47);">           4、</span><span style="font-size: 12pt; color: rgb(36, 41, 47);">componentDidMount （常用，做初始化方法）</span></div><div><span style="font-size: 16px; color: rgb(36, 41, 47);">        </span></div><div><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(36, 41, 47); font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, &quot;Noto Sans&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">更新阶段  -- 由组件内部this.setState()或父组件重新render触发</span></div><div><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(36, 41, 47); font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, &quot;Noto Sans&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">             1、</span><span style="font-size: 12pt; color: rgb(36, 41, 47);">shouldComponentUpdate</span></div><div><span style="font-size: 12pt; color: rgb(36, 41, 47);">            2、</span><span style="font-size: 12pt; color: rgb(36, 41, 47);">componentWillUpdate</span></div><div><span style="font-size: 12pt; color: rgb(36, 41, 47);">            3、</span><span style="font-size: 12pt; color: rgb(36, 41, 47);">render  （必用）</span></div><div><span style="font-size: 12pt; color: rgb(36, 41, 47);">            4、</span><span style="font-size: 12pt; color: rgb(36, 41, 47);">componentDidUpdate</span></div><div><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(36, 41, 47); font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, &quot;Noto Sans&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">销毁阶段 -- 由</span><span style="color: rgb(36, 41, 47); font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, &quot;Noto Sans&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;;"> ReactDOM.unmountComponentAtNode触发</span></div><div><span style="color: rgb(36, 41, 47); font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, &quot;Noto Sans&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;;">                1、</span><span style="color: rgb(36, 41, 47);">componentWillUnmount （做一些收尾的工作，如关闭定时器等）</span></div><div><span style="font-size: 16px;"><br/></span></div></span>
</div></body></html> 